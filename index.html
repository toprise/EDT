<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>通用加密解密工具</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg-light:#eaf6ff;--header-light:#cfe8fc;--btn-light:#a5d8ff;
      --bg-pink:#fff0f5;--header-pink:#ffd3e0;--btn-pink:#ffb0c9;
      --bg-dark:#2c2c2e;--header-dark:#3a3a3c;--btn-dark:#5e5e60;
      --txt-light:#333;--txt-dark:#f2f2f7;
    }
    body{font-family:'Noto Sans SC',sans-serif;margin:30px;display:flex;flex-direction:column;align-items:center;
      background:var(--bg-light);color:var(--txt-light);transition:.3s;}
    body.dark{background:var(--bg-dark);color:var(--txt-dark);}
    .card{width:800px;background:#fff;border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.15);overflow:hidden;transition:.3s;}
    .card.dark{background:var(--bg-dark);}
    .theme-card{width:800px;display:flex;justify-content:flex-end;gap:10px;margin-bottom:20px;padding:15px;border-radius:20px;
      box-shadow:0 6px 16px rgba(0,0,0,0.1);transition:.3s;}
    .theme-card.dark{background:var(--header-dark);}
    .theme-btn, .lang-select{border:none;border-radius:12px;padding:8px 16px;font-size:14px;cursor:pointer;background:#eee;color:#333;
      transition:.3s;}
    .theme-card.dark .theme-btn,.theme-card.dark .lang-select{background:var(--btn-dark);color:var(--txt-dark);}
    .theme-btn.selected.blue{background:var(--btn-light);color:#fff;}
    .theme-btn.selected.pink{background:var(--btn-pink);color:#fff;}
    .tabs{display:flex;background:var(--header-light);transition:.3s;}
    .tabs.dark{background:var(--header-dark);}
    .tabs div{flex:1;text-align:center;padding:15px;cursor:pointer;font-weight:500;transition:.3s;}
    .tabs div.active{background:var(--bg-light);border-bottom:3px solid #42a5f5;}
    .tabs.dark div.active{background:var(--header-dark);}
    .card-header{text-align:center;background:var(--header-light);padding:12px;font-size:20px;font-weight:500;transition:.3s;}
    .card-header.dark{background:var(--header-dark);}
    .card-body{padding:20px;transition:.3s;}
    .card-body.dark{background:var(--bg-dark);}
    .section{display:none;}
    .section.active{display:block;}
    label{display:block;margin-top:10px;font-weight:500;}
    textarea,select,input,button{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc;font-size:14px;transition:.3s;}
    body.dark textarea,body.dark select,body.dark input{background:#3a3a3c;color:var(--txt-dark);border:1px solid #555;}
    button{background:var(--btn-light);color:#fff;border:none;cursor:pointer;}
    body.dark button{background:var(--btn-dark);}
    button:hover{opacity:.9;}
    .disabled{background:#eee;cursor:not-allowed;}
    .storage{display:flex;gap:10px;margin-top:10px;}
    .storage button{flex:1;}
  </style>
</head>
<body>

  <!-- 主题/语言/夜间 控制 -->
  <div class="theme-card" id="themeCard">
    <button class="theme-btn blue selected" onclick="setTheme('blue')">🔵 浅蓝</button>
    <button class="theme-btn pink" onclick="setTheme('pink')">🌸 淡粉</button>
    <button class="theme-btn" onclick="toggleDark()">🌓 <span data-i18n="dark">夜间</span></button>
    <select class="lang-select" id="langSelect" onchange="setLang(this.value)">
      <option value="zh">中文</option><option value="en">English</option>
    </select>
  </div>

  <div class="card" id="mainCard">
    <!-- Tabs -->
    <div class="tabs" id="tabs">
      <div id="tab-key" class="active" onclick="showSection('key')" data-i18n="tabKey">密钥管理</div>
      <div id="tab-encrypt" onclick="showSection('encrypt')" data-i18n="tabEncrypt">加密</div>
      <div id="tab-decrypt" onclick="showSection('decrypt')" data-i18n="tabDecrypt">解密</div>
    </div>
    <div class="card-header" id="header">密钥管理</div>
    <div class="card-body" id="body">

      <!-- 密钥管理 -->
      <div id="section-key" class="section active">
        <label data-i18n="keyLen">选择 RSA 密钥长度：</label>
        <select id="keySize" onchange="onKeyLen()">
          <option value="">-- 请选择 --</option><option>512</option><option>1024</option><option>2048</option>
        </select>
        <button id="genBtn" class="disabled" onclick="genRSA()" disabled data-i18n="genKey">生成密钥对</button>
        <div class="storage">
          <button onclick="saveRSA()" data-i18n="saveKey">💾 保存密钥</button>
          <button onclick="loadRSA()" data-i18n="loadKey">📂 加载密钥</button>
        </div>
        <label data-i18n="pubKey">公钥（PEM）</label><textarea id="pubKey"></textarea>
        <label data-i18n="priKey">私钥（PEM）</label><textarea id="priKey"></textarea>
      </div>

      <!-- 加密 -->
      <div id="section-encrypt" class="section">
        <label data-i18n="algo">算法：</label>
        <select id="algoEnc" onchange="togglePane('enc')">
          <option>RSA-OAEP</option><option>RSAES-PKCS1-V1_5</option><option>AES-CBC</option>
        </select>
        <div id="rsaEncPane">
          <label data-i18n="plaintext">待加密明文：</label><textarea id="textInEnc"></textarea>
        </div>
        <div id="aesEncPane" style="display:none">
          <label data-i18n="aesPwd">密码：</label><input type="password" id="aesPwdEnc"/>
          <label data-i18n="plaintext">待加密明文：</label><textarea id="textInAESEnc"></textarea>
        </div>
        <button onclick="doEncrypt()" data-i18n="encrypt">加密</button>
        <label data-i18n="result">结果(Base64)：</label><textarea id="textOutEnc" readonly></textarea>
      </div>

      <!-- 解密 -->
      <div id="section-decrypt" class="section">
        <label data-i18n="algo">算法：</label>
        <select id="algoDec" onchange="togglePane('dec')">
          <option>RSA-OAEP</option><option>RSAES-PKCS1-V1_5</option><option>AES-CBC</option>
        </select>
        <div id="rsaDecPane">
          <label data-i18n="ciphertext">待解密密文(Base64)：</label><textarea id="textInDec"></textarea>
        </div>
        <div id="aesDecPane" style="display:none">
          <label data-i18n="aesPwd">密码：</label><input type="password" id="aesPwdDec"/>
          <label data-i18n="ciphertext">待解密密文(Base64)：</label><textarea id="textInAESDec"></textarea>
        </div>
        <button onclick="doDecrypt()" data-i18n="decrypt">解密</button>
        <label data-i18n="decrypted">解密结果：</label><textarea id="textOutDec" readonly></textarea>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <script>
    // i18n 文案
    const I18N={zh:{tabKey:'密钥管理',tabEncrypt:'加密',tabDecrypt:'解密',dark:'夜间',
      keyLen:'选择 RSA 密钥长度：',genKey:'生成密钥对',saveKey:'保存密钥',loadKey:'加载密钥',
      pubKey:'公钥（PEM）',priKey:'私钥（PEM）',algo:'算法：',plaintext:'明文：',
      aesPwd:'密码：',encrypt:'加密',decrypt:'解密',result:'结果(Base64)：',
      ciphertext:'密文(Base64)：',decrypted:'解密结果：'},
      en:{tabKey:'Key Mgmt',tabEncrypt:'Encrypt',tabDecrypt:'Decrypt',dark:'Dark',
      keyLen:'RSA Key Size:',genKey:'Gen KeyPair',saveKey:'Save Key',loadKey:'Load Key',
      pubKey:'Public Key (PEM)',priKey:'Private Key (PEM)',algo:'Algorithm:',
      plaintext:'Plaintext:',aesPwd:'Password:',encrypt:'Encrypt',decrypt:'Decrypt',
      result:'Result(Base64):',ciphertext:'Ciphertext(Base64):',decrypted:'Decrypted:'}
    };
    let lang='zh',rsaPub,rsaPri;

    function setLang(l){lang=l;document.querySelectorAll('[data-i18n]').forEach(e=>e.textContent=I18N[l][e.getAttribute('data-i18n')]||e.textContent);}

    function setTheme(c){document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('selected'));document.querySelector(`.theme-btn.${c}`)?.classList.add('selected');
      const m={blue:['#eaf6ff','#cfe8fc','#a5d8ff'],pink:['#fff0f5','#ffd3e0','#ffb0c9']}[c];
      document.documentElement.style.setProperty('--bg-light',m[0]);
      document.documentElement.style.setProperty('--header-light',m[1]);
      document.documentElement.style.setProperty('--btn-light',m[2]);updateThemeUI();
    }
    function updateThemeUI(){
      document.querySelector('.tabs').style.background=getComputedStyle(document.documentElement).getPropertyValue('--header-light');
      document.querySelector('.card-header').style.background=getComputedStyle(document.documentElement).getPropertyValue('--header-light');
      document.querySelectorAll('button:not(.theme-btn)').forEach(b=>b.style.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue('--btn-light'));
    }
    function toggleDark(){
      document.body.classList.toggle('dark');
      ['themeCard','mainCard','tabs','header','body'].forEach(id=>document.getElementById(id)?.classList.toggle('dark'));
    }
    function showSection(sec){
      ['key','encrypt','decrypt'].forEach(id=>{
        document.getElementById('section-'+id).classList.remove('active');
        document.getElementById('tab-'+id).classList.remove('active');
      });
      document.getElementById('section-'+sec).classList.add('active');
      document.getElementById('tab-'+sec).classList.add('active');
      document.getElementById('header').textContent=I18N[lang][sec==='key'?'tabKey':sec==='encrypt'?'tabEncrypt':'tabDecrypt'];
    }

    // RSA 管理
    function onKeyLen(){const ok=!!document.getElementById('keySize').value;document.getElementById('genBtn').disabled=!ok;document.getElementById('genBtn').classList.toggle('disabled',!ok);}
    function genRSA(){const sz=+document.getElementById('keySize').value;const kp=forge.pki.rsa.generateKeyPair({bits:sz,e:0x10001});rsaPub=kp.publicKey;rsaPri=kp.privateKey;
      document.getElementById('pubKey').value=forge.pki.publicKeyToPem(rsaPub);
      document.getElementById('priKey').value=forge.pki.privateKeyToPem(rsaPri);
    }
    function saveRSA(){localStorage.setItem('rsa_pub',document.getElementById('pubKey').value);localStorage.setItem('rsa_pri',document.getElementById('priKey').value);alert('Saved');}
    function loadRSA(){const p=localStorage.getItem('rsa_pub'),r=localStorage.getItem('rsa_pri');if(p||r){document.getElementById('pubKey').value=p||'';document.getElementById('priKey').value=r||'';alert('Loaded');}else alert('No key');}

    // 加密/解密
    function togglePane(mode){
      ['rsa'+mode.charAt(0).toUpperCase()+mode.slice(1)+'Pane','aes'+mode.charAt(0).toUpperCase()+mode.slice(1)+'Pane'].forEach(id=>{
        document.getElementById(id).style.display='none';
      });
      const algo=document.getElementById('algo'+(mode==='Enc'?'Enc':'Dec')).value;
      document.getElementById((algo.startsWith('RSA')?'rsa':'aes')+mode.charAt(0).toUpperCase()+mode.slice(1)+'Pane').style.display='block';
    }
    function doEncrypt(){
      let out,algo=document.getElementById('algoEnc').value;
      if(algo==='AES-CBC'){
        const pwd=document.getElementById('aesPwdEnc').value,iv=forge.random.getBytesSync(16);
        const key=forge.pkcs5.pbkdf2(pwd,pwd,1000,16);
        const cipher=forge.cipher.createCipher('AES-CBC',key);
        cipher.start({iv});cipher.update(forge.util.createBuffer(document.getElementById('textInAESEnc').value,'utf8'));cipher.finish();
        out=forge.util.encode64(iv+cipher.output.getBytes());
      } else {
        loadRSA();const data=forge.util.encodeUtf8(document.getElementById('textInEnc').value);
        out=forge.util.encode64(rsaPub.encrypt(data,algo));
      }
      document.getElementById('textOutEnc').value=out;
    }
    function doDecrypt(){
      let out,algo=document.getElementById('algoDec').value;
      if(algo==='AES-CBC'){
        const pwd=document.getElementById('aesPwdDec').value;
        const bytes=forge.util.decode64(document.getElementById('textInAESDec').value);
        const iv=bytes.slice(0,16),ct=bytes.slice(16);
        const key=forge.pkcs5.pbkdf2(pwd,pwd,1000,16);
        const decipher=forge.cipher.createDecipher('AES-CBC',key);
        decipher.start({iv});decipher.update(forge.util.createBuffer(ct));decipher.finish();
        out=forge.util.decodeUtf8(decipher.output.getBytes());
      } else {
        loadRSA();const buf=forge.util.decode64(document.getElementById('textInDec').value);
        out=forge.util.decodeUtf8(rsaPri.decrypt(buf,algo));
      }
      document.getElementById('textOutDec').value=out;
    }
  </script>
</body>
</html>
