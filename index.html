<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title data-i18n="title">é€šç”¨åŠ å¯†è§£å¯†å·¥å…·</title>
  <!-- å¼•å…¥ä¸­æ–‡å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    /* ä¸»é¢˜è‰²å˜é‡å®šä¹‰ */
    :root {
      --bg-light: #eaf6ff;
      --header-light: #cfe8fc;
      --btn-light: #a5d8ff;
      --bg-pink: #fff0f5;
      --header-pink: #ffd3e0;
      --btn-pink: #ffb0c9;
      --bg-dark: #2c2c2e;
      --header-dark: #3a3a3c;
      --btn-dark: #5e5e60;
      --txt-light: #333;
      --txt-dark: #f2f2f7;
    }

    body {
      font-family: 'Noto Sans SC', sans-serif;
      margin: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--bg-light);
      color: var(--txt-light);
      transition: background .3s, color .3s;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--txt-dark);
    }

    .card,
    .theme-card {
      width: 1000px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      transition: background .3s;
    }

    .card {
      background: #fff;
      overflow: hidden;
    }

    .card.dark {
      background: var(--bg-dark);
    }

    .theme-card {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: var(--header-light);
    }

    .theme-card.dark {
      background: var(--header-dark);
    }

    .theme-card>* {
      flex: 1;
      text-align: center;
    }

    .theme-btn,
    .lang-select {
      border: none;
      border-radius: 12px;
      padding: 8px 16px;
      cursor: pointer;
      background: #eee;
      transition: background .3s, color .3s;
    }

    .theme-card.dark .theme-btn,
    .theme-card.dark .lang-select {
      background: var(--btn-dark);
      color: var(--txt-dark);
    }

    .theme-btn.selected.blue {
      background: var(--btn-light);
      color: #fff;
    }

    .theme-btn.selected.pink {
      background: var(--btn-pink);
      color: #fff;
    }

    .tabs {
      display: flex;
      background: var(--header-light);
    }

    .tabs.dark {
      background: var(--header-dark);
    }

    .tabs div {
      flex: 1;
      text-align: center;
      padding: 12px 8px;
      /* å‡å°‘å·¦å³å†…è¾¹è·é¿å…æ¢è¡Œ */
      cursor: pointer;
      font-weight: 500;
      transition: background .3s;
      white-space: nowrap;
      /* ç¦æ­¢æ¢è¡Œ */
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tabs div.active {
      background: var(--bg-light);
      border-bottom: 3px solid #42a5f5;
    }

    .tabs.dark div.active {
      background: var(--header-dark);
    }

    .card-header {
      text-align: center;
      background: var(--header-light);
      padding: 12px;
      font-size: 20px;
      font-weight: 500;
      transition: background .3s;
    }

    .card-header.dark {
      background: var(--header-dark);
    }

    .card-body {
      padding: 20px;
      transition: background .3s;
    }

    .card-body.dark {
      background: var(--bg-dark);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
    }

    /* Removed duplicate rule */

    /* å¤œé—´æ¨¡å¼ä¸‹è¡¨å•æ§ä»¶æš—è‰²èƒŒæ™¯ */
    body.dark textarea,
    body.dark select,
    body.dark input {
      background: #3a3a3c;
      color: var(--txt-dark);
      border: 1px solid #555;
    }

    body.dark select,
    body.dark input {
      background: #3a3a3c;
      color: var(--txt-dark);
      border: 1px solid #555;
    }

    textarea,
    select,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      transition: background .3s, border .3s;
    }

    button {
      background: var(--btn-light);
      color: #fff;
      border: none;
      cursor: pointer;
    }

    body.dark button {
      background: var(--btn-dark);
    }

    button:hover {
      opacity: .9;
    }

    .disabled {
      background: #eee;
      cursor: not-allowed;
    }

    .storage {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .storage button {
      flex: 1;
    }

    #qrCode {
      margin-top: 20px;
    }

    .about-content {
      font-size: 16px;
      line-height: 1.5;
    }

    .about-content a {
      color: #42a5f5;
      text-decoration: none;
    }

    .about-content a:hover {
      text-decoration: underline;
    }

    button {
      background: var(--btn-light);
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button.enabled {
      background: var(--btn-light);
    }

    button.disabled {
      background: #eee;
      cursor: not-allowed;
    }

    button:hover {
      opacity: .9;
    }

    body.dark button.enabled {
      background: var(--btn-dark);
    }

    body.dark button.disabled {
      background: #444;
    }

    select {
      appearance: none;
      /* ç§»é™¤é»˜è®¤æ ·å¼ */
      background: var(--btn-light);
      color: var(--txt-light);
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      cursor: pointer;
      transition: background .3s, color .3s, border .3s;
    }

    body.dark select {
      background: var(--btn-dark);
      color: var(--txt-dark);
      border: 1px solid #555;
    }

    select:hover {
      border-color: #888;
    }

    select:focus {
      outline: none;
      border-color: #42a5f5;
    }

    /* æ–°å¢ï¼šä½¿ç”¨æ¬¡æ•°è®¡æ•°åœ¨å¡ç‰‡ä¸‹æ–¹ */
    #usageCounter {
      text-align: right;
      margin-top: 10px;
      font-weight: bold;
    }

    /* æ–°å¢ï¼šé™åˆ¶é«˜çº§åŠŸèƒ½å¼¹çª—ä¸­æ–‡æœ¬æ¡†çš„å®½åº¦ */
    #advancedModal input {
      width: 80%;
      max-width: 300px;
    }

    /* ä¿®æ”¹å…¨å±€æ§ä»¶æ ·å¼ï¼Œå®ç°æ–‡æœ¬æ¡†ã€ä¸‹æ‹‰ã€æŒ‰é’®å®½åº¦ä¸€è‡´ä¸”è¾ƒé•¿ */
    input,
    textarea,
    select,
    button {
      width: 100%;
      box-sizing: border-box;
      min-width: 300px;
    }

    /* å¤šè¡Œæ–‡æœ¬åŸŸå…è®¸å‚ç›´è°ƒæ•´ï¼Œä¸å…è®¸æ°´å¹³è°ƒæ•´ */
    textarea {
      resize: vertical;
    }

    /* å•è¡Œè¾“å…¥æ§ä»¶ä¸å…è®¸è°ƒæ•´å°ºå¯¸ */
    input {
      resize: none;
    }

    /* ä¿ç•™é«˜çº§å¼¹çª—å®¹å™¨å®½åº¦è®¾ç½® */
    #advancedModal {
      width: 400px;
    }

    /* æ¢å¤ä¸»é¢˜å¡ç‰‡æ§ä»¶å®½åº¦ */
    .theme-card .theme-btn,
    .theme-card .lang-select {
      width: auto !important;
      min-width: 0 !important;
      box-sizing: content-box;
    }

    /* æ–°å¢ï¼šè¿›åº¦æ¡æ ·å¼ */
    #progressContainer {
      display: none;
      position: relative; /* åŸ fixed æ”¹ä¸º relative */
      width: 100%;
      height: 5px;
      background: #ddd;
      z-index: 1100;
    }

    #progressBar {
      width: 0%;
      height: 100%;
      background: #42a5f5;
      transition: width 0.1s;
    }
  </style>
</head>

<body>
  <div class="theme-card" id="themeCard">
    <button class="theme-btn blue selected" onclick="setTheme('blue')" data-i18n="blue">ğŸ”µ æµ…è“</button>
    <button class="theme-btn pink" onclick="setTheme('pink')" data-i18n="pink">ğŸŒ¸ æ·¡ç²‰</button>
    <button class="theme-btn" onclick="toggleDark()" data-i18n="dark">ğŸŒ“ å¤œé—´</button>
    <select class="lang-select" id="langSelect" onchange="setLang(this.value)">
      <option value="zh">ä¸­æ–‡</option>
      <option value="en">English</option>
    </select>
  </div>
  <div class="card" id="mainCard">
    <div class="tabs" id="tabs">
      <div id="tab-key" class="active" onclick="showSection('key')" data-i18n="tabKey">å¯†é’¥ç®¡ç†</div>
      <div id="tab-encrypt" onclick="showSection('encrypt')" data-i18n="tabEncrypt">åŠ å¯†</div>
      <div id="tab-decrypt" onclick="showSection('decrypt')" data-i18n="tabDecrypt">è§£å¯†</div>
      <div id="tab-hash" onclick="showSection('hash')" data-i18n="tabHash">å“ˆå¸Œä¸ HMAC</div>
      <div id="tab-qr" onclick="showSection('qr')" data-i18n="tabQR">äºŒç»´ç ç”Ÿæˆ</div>
      <div id="tab-file" onclick="showSection('file')" data-i18n="tabFile">æ–‡ä»¶åŠ å¯†/è§£å¯†</div>
      <div id="tab-about" onclick="showSection('about')" data-i18n="tabAbout">å…³äº</div>
      <div id="tab-advanced" onclick="showSection('advanced')" data-i18n="tabAdvanced">é«˜çº§åŠŸèƒ½</div>
    </div>
    <div class="card-header" id="header" data-i18n="tabKey">å¯†é’¥ç®¡ç†</div>
    <div class="card-body" id="body">
      <!-- å¯†é’¥ç®¡ç† -->
      <div id="section-key" class="section active">
        <label data-i18n="selectKeySize">é€‰æ‹© RSA å¯†é’¥é•¿åº¦ï¼š</label>
        <select id="keySize" onchange="onKeyLen()">
          <option value="" data-i18n="pleaseSelect">-- è¯·é€‰æ‹© --</option>
          <option>512</option>
          <option>1024</option>
          <option>2048</option>
        </select>
        <button id="genBtn" class="disabled" onclick="genRSA()" disabled data-i18n="genKeyPair">ç”Ÿæˆå¯†é’¥å¯¹</button>
        <div class="storage">
          <button onclick="saveRSA()" data-i18n="saveKey">ğŸ’¾ ä¿å­˜å¯†é’¥</button>
          <button onclick="loadRSA()" data-i18n="loadKey">ğŸ“‚ åŠ è½½å¯†é’¥</button>
        </div>
        <label data-i18n="publicKey">å…¬é’¥(PEM)</label>
        <textarea id="pubKey"></textarea>
        <label data-i18n="privateKey">ç§é’¥(PEM)</label>
        <textarea id="priKey"></textarea>
      </div>
      <!-- åŠ å¯† -->
      <div id="section-encrypt" class="section">
        <label data-i18n="algorithm">ç®—æ³•ï¼š</label>
        <select id="algoEnc" onchange="togglePane('Enc')">
          <option>RSA-OAEP</option>
          <option>RSAES-PKCS1-V1_5</option>
          <option>AES-CBC</option>
        </select>
        <div id="rsaEncPane">
          <label data-i18n="plainText">å¾…åŠ å¯†æ˜æ–‡ï¼š</label>
          <textarea id="textInEnc"></textarea>
        </div>
        <div id="aesEncPane" style="display:none">
          <label data-i18n="password">å¯†ç ï¼š</label>
          <input type="password" id="aesPwdEnc" />
          <label data-i18n="plainText">å¾…åŠ å¯†æ˜æ–‡ï¼š</label>
          <textarea id="textInAESEnc"></textarea>
        </div>
        <button onclick="doEncrypt()" data-i18n="encrypt">åŠ å¯†</button>
        <label data-i18n="result">ç»“æœ(Base64)ï¼š</label>
        <textarea id="textOutEnc" readonly></textarea>
      </div>
      <!-- è§£å¯† -->
      <div id="section-decrypt" class="section">
        <label data-i18n="algorithm">ç®—æ³•ï¼š</label>
        <select id="algoDec" onchange="togglePane('Dec')">
          <option>RSA-OAEP</option>
          <option>RSAES-PKCS1-V1_5</option>
          <option>AES-CBC</option>
        </select>
        <div id="rsaDecPane">
          <label data-i18n="cipherText">å¾…è§£å¯†å¯†æ–‡(Base64)ï¼š</label>
          <textarea id="textInDec"></textarea>
        </div>
        <div id="aesDecPane" style="display:none">
          <label data-i18n="password">å¯†ç ï¼š</label>
          <input type="password" id="aesPwdDec" />
          <label data-i18n="cipherText">å¾…è§£å¯†å¯†æ–‡(Base64)ï¼š</label>
          <textarea id="textInAESDec"></textarea>
        </div>
        <button onclick="doDecrypt()" data-i18n="decrypt">è§£å¯†</button>
        <label data-i18n="decryptedResult">è§£å¯†ç»“æœï¼š</label>
        <textarea id="textOutDec" readonly></textarea>
      </div>
      <!-- å“ˆå¸Œä¸ HMAC -->
      <div id="section-hash" class="section">
        <label data-i18n="selectHashAlgorithm">é€‰æ‹©ç®—æ³•ï¼š</label>
        <select id="hashAlgo">
          <option>SHA-256</option>
          <option>SHA-512</option>
          <option>MD5</option>
        </select>
        <label data-i18n="inputContent">è¾“å…¥å†…å®¹ï¼š</label>
        <textarea id="hashInput"></textarea>
        <button onclick="generateHash()" data-i18n="generateHash">ç”Ÿæˆå“ˆå¸Œ</button>
        <label data-i18n="hashResult">å“ˆå¸Œç»“æœï¼š</label>
        <textarea id="hashOutput" readonly></textarea>
        <label data-i18n="selectHMACAlgorithm">é€‰æ‹© HMAC ç®—æ³•ï¼š</label>
        <select id="hmacAlgo">
          <option>SHA-256</option>
          <option>SHA-512</option>
          <option>MD5</option>
        </select>
        <label data-i18n="key">å¯†é’¥ï¼š</label>
        <input type="text" id="hmacKey" />
        <label data-i18n="inputContent">è¾“å…¥å†…å®¹ï¼š</label>
        <textarea id="hmacInput"></textarea>
        <button onclick="generateHMAC()" data-i18n="generateHMAC">ç”Ÿæˆ HMAC</button>
        <label data-i18n="hmacResult">HMAC ç»“æœï¼š</label>
        <textarea id="hmacOutput" readonly></textarea>
      </div>
      <!-- äºŒç»´ç ç”Ÿæˆ -->
      <div id="section-qr" class="section">
        <label data-i18n="qrInput">è¾“å…¥æ–‡æœ¬ï¼š</label>
        <textarea id="qrText"></textarea>
        <button onclick="generateQRCode()" data-i18n="generateQRCode">ç”ŸæˆäºŒç»´ç </button>
        <div id="qrCode"></div>
      </div>
      <!-- æ–‡ä»¶ -->
      <div id="section-file" class="section">
        <label data-i18n="selectFile">é€‰æ‹©æ–‡ä»¶ï¼š</label>
        <input type="file" id="fileInput" />
        <!-- æ–°å¢ï¼šé€‰æ‹©åŠ å¯†ç®—æ³• -->
        <label data-i18n="selectEncryptionAlgorithm">é€‰æ‹©åŠ å¯†ç®—æ³•ï¼š</label>
        <select id="fileAlgo">
          <option value="RSA-OAEP">RSA-OAEP</option>
          <option value="AES-CBC">AES-CBC</option>
        </select>
        <!-- æ–°å¢ï¼šAESå¯†é’¥è¾“å…¥ï¼Œä»…åœ¨é€‰ç”¨AESæ—¶æ˜¾ç¤º -->
        <div id="fileAesKeyContainer" style="display:none">
          <label data-i18n="manualAESKey">æ‰‹åŠ¨è¾“å…¥AESå¯†é’¥(è‡³å°‘16å­—ç¬¦)ï¼š</label>
          <input type="text" id="fileAesKey" />
        </div>
        <button id="encryptFileBtn" disabled data-i18n="encryptFile">åŠ å¯†æ–‡ä»¶</button>
        <button id="decryptFileBtn" disabled data-i18n="decryptFile">è§£å¯†æ–‡ä»¶</button>
      </div>
      <!-- å…³äº -->
      <div id="section-about" class="section">
        <div class="about-content">
          <p data-i18n="author">ä½œè€…ï¼štoprise</p>
          <p data-i18n="version">ç‰ˆæœ¬ï¼šVersion 17.8.4</p>
          <p>GitHubï¼š<a href="https://github.com/toprise/EDT" target="_blank" data-i18n="github">ä»“åº“é“¾æ¥</a></p>
        </div>
      </div>
      <!-- é«˜çº§åŠŸèƒ½ -->
      <div id="section-advanced" class="section">
        <button id="unlockBtn" onclick="showAdvancedModal()" data-i18n="unlockAdvanced">è§£é”é«˜çº§åŠŸèƒ½</button>
      </div>
      <!-- åœ¨å¡ç‰‡åº•éƒ¨æ˜¾ç¤ºä½¿ç”¨æ¬¡æ•° -->
      <div id="usageCounter"></div>
    </div>
    <!-- æ–°å¢ï¼šå°†è¿›åº¦æ¡å…ƒç´ æ”¾å…¥å¡ç‰‡å†…éƒ¨ -->
    <div id="progressContainer">
      <div id="progressBar"></div>
    </div>
  </div>

  <!-- æ–°å¢ï¼šå¼¹çª—åŠé®ç½©å±‚ -->
  <div id="modalOverlay"
    style="display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
  </div>
  <!-- ä¿®æ”¹ï¼šå¢åŠ å®½åº¦åˆ°400px -->
  <div id="advancedModal"
    style="display:none; position:fixed; left:50%; top:50%; transform: translate(-50%, -50%); width:400px; background:#fff; border-radius:10px; padding:20px; box-shadow: 0 0 15px rgba(0,0,0,0.5); z-index:1001;">
    <span id="closeModal" style="cursor:pointer; position:absolute; right:10px; top:10px;">Ã—</span>
    <h3 data-i18n="advancedTitle">è§£é”é«˜çº§åŠŸèƒ½</h3>
    <label data-i18n="account">è´¦æˆ·:</label>
    <input type="text" id="accountInput" />
    <label data-i18n="password">å¯†ç :</label>
    <input type="password" id="passwordInput" />
    <button onclick="attemptUnlock()" data-i18n="login">ç™»å½•</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", function () {
      const I18N = {
        zh: {
          title: "é€šç”¨åŠ å¯†è§£å¯†å·¥å…·",
          blue: "ğŸ”µ æµ…è“",
          pink: "ğŸŒ¸ æ·¡ç²‰",
          dark: "ğŸŒ“ å¤œé—´",
          tabKey: "å¯†é’¥ç®¡ç†",
          tabEncrypt: "åŠ å¯†",
          tabDecrypt: "è§£å¯†",
          tabHash: "å“ˆå¸Œä¸ HMAC",
          tabQR: "äºŒç»´ç ç”Ÿæˆ",
          tabFile: "æ–‡ä»¶åŠ å¯†/è§£å¯†",
          tabAdvanced: "é«˜çº§åŠŸèƒ½",
          tabAbout: "å…³äº",
          selectKeySize: "é€‰æ‹© RSA å¯†é’¥é•¿åº¦ï¼š",
          pleaseSelect: "-- è¯·é€‰æ‹© --",
          genKeyPair: "ç”Ÿæˆå¯†é’¥å¯¹",
          saveKey: "ğŸ’¾ ä¿å­˜å¯†é’¥",
          loadKey: "ğŸ“‚ åŠ è½½å¯†é’¥",
          publicKey: "å…¬é’¥(PEM)",
          privateKey: "ç§é’¥(PEM)",
          algorithm: "ç®—æ³•ï¼š",
          plainText: "å¾…åŠ å¯†æ˜æ–‡ï¼š",
          encrypt: "åŠ å¯†",
          result: "ç»“æœ(Base64)ï¼š",
          cipherText: "å¾…è§£å¯†å¯†æ–‡(Base64)ï¼š",
          decrypt: "è§£å¯†",
          decryptedResult: "è§£å¯†ç»“æœï¼š",
          selectHashAlgorithm: "é€‰æ‹©ç®—æ³•ï¼š",
          inputContent: "è¾“å…¥å†…å®¹ï¼š",
          generateHash: "ç”Ÿæˆå“ˆå¸Œ",
          hashResult: "å“ˆå¸Œç»“æœï¼š",
          selectHMACAlgorithm: "é€‰æ‹© HMAC ç®—æ³•ï¼š",
          key: "å¯†é’¥ï¼š",
          generateHMAC: "ç”Ÿæˆ HMAC",
          hmacResult: "HMAC ç»“æœï¼š",
          qrInput: "è¾“å…¥æ–‡æœ¬ï¼š",
          generateQRCode: "ç”ŸæˆäºŒç»´ç ",
          selectFile: "é€‰æ‹©æ–‡ä»¶ï¼š",
          selectEncryptionAlgorithm: "é€‰æ‹©åŠ å¯†ç®—æ³•ï¼š",
          manualAESKey: "æ‰‹åŠ¨è¾“å…¥AESå¯†é’¥(è‡³å°‘16å­—ç¬¦)ï¼š",
          encryptFile: "åŠ å¯†æ–‡ä»¶",
          decryptFile: "è§£å¯†æ–‡ä»¶",
          author: "ä½œè€…ï¼štoprise",
          version: "ç‰ˆæœ¬ï¼šVersion 17.8.4",
          github: "ä»“åº“é“¾æ¥",
          unlockAdvanced: "è§£é”é«˜çº§åŠŸèƒ½",
          advancedTitle: "è§£é”é«˜çº§åŠŸèƒ½",
          account: "è´¦æˆ·ï¼š",
          password: "å¯†ç ï¼š",
          login: "ç™»å½•",
          usageCounter: "å‰©ä½™æ¬¡æ•°:"
        },
        en: {
          title: "Encryption/Decryption Tool",
          blue: "ğŸ”µ Light Blue",
          pink: "ğŸŒ¸ Light Pink",
          dark: "ğŸŒ“ Dark",
          tabKey: "Key Mgmt",
          tabEncrypt: "Encrypt",
          tabDecrypt: "Decrypt",
          tabHash: "Hash & HMAC",
          tabQR: "QR Code",
          tabFile: "File Enc/Dec",
          tabAdvanced: "Advanced",
          tabAbout: "About",
          selectKeySize: "Select RSA Key Size:",
          pleaseSelect: "-- Please Select --",
          genKeyPair: "Generate Key Pair",
          saveKey: "ğŸ’¾ Save Key",
          loadKey: "ğŸ“‚ Load Key",
          publicKey: "Public Key (PEM)",
          privateKey: "Private Key (PEM)",
          algorithm: "Algorithm:",
          plainText: "Plaintext:",
          encrypt: "Encrypt",
          result: "Result (Base64):",
          cipherText: "Ciphertext (Base64):",
          decrypt: "Decrypt",
          decryptedResult: "Decrypted Result:",
          selectHashAlgorithm: "Select Algorithm:",
          inputContent: "Input:",
          generateHash: "Generate Hash",
          hashResult: "Hash Result:",
          selectHMACAlgorithm: "Select HMAC Algorithm:",
          key: "Key:",
          generateHMAC: "Generate HMAC",
          hmacResult: "HMAC Result:",
          qrInput: "Input Text:",
          generateQRCode: "Generate QR Code",
          selectFile: "Select File:",
          selectEncryptionAlgorithm: "Select Encryption Algorithm:",
          manualAESKey: "Enter AES Key (at least 16 characters):",
          encryptFile: "Encrypt File",
          decryptFile: "Decrypt File",
          author: "Author: toprise",
          version: "Version: 17.8.4",
          github: "GitHub Link",
          unlockAdvanced: "Unlock Advanced Features",
          advancedTitle: "Unlock Advanced Features",
          account: "Account:",
          password: "Password:",
          login: "Login",
          usageCounter: "Remaining Uses:"
        }
      };
      let lang = 'zh', rsaPub, rsaPri;
      function setLang(l) { 
        lang = l; 
        document.querySelectorAll('[data-i18n]').forEach(e => { 
          e.textContent = I18N[lang][e.getAttribute('data-i18n')]; 
        }); 
        updateHeader(); 
        updateUsageUI(getCookie("advancedUnlocked") === "true" ? "æ— é™åˆ¶" : getCookie("usageRemaining") || 10);
      }
      function updateHeader() { 
        const sec = document.querySelector('.tabs .active').id.replace('tab-', '');
        document.getElementById('header').textContent = I18N[lang]['tab' + sec.charAt(0).toUpperCase() + sec.slice(1)];
      }
      function updateUsageUI(val) {
        const usageDiv = document.getElementById("usageCounter");
        usageDiv.textContent = I18N[lang].usageCounter + " " + val;
      }
      function setTheme(c) { document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected')); document.querySelector(`.theme-btn.${c}`).classList.add('selected'); const m = { blue: ['#eaf6ff', '#cfe8fc', '#a5d8ff'], pink: ['#fff0f5', '#ffd3e0', '#ffb0c9'] }[c]; document.documentElement.style.setProperty('--bg-light', m[0]); document.documentElement.style.setProperty('--header-light', m[1]); document.documentElement.style.setProperty('--btn-light', m[2]); document.querySelector('.tabs').style.background = m[1]; document.querySelector('.card-header').style.background = m[1]; document.querySelectorAll('button:not(.theme-btn)').forEach(b => b.style.backgroundColor = m[2]); }
      function toggleDark() { 
        ['body', 'themeCard', 'mainCard', 'tabs', 'header'].forEach(id => document.getElementById(id)?.classList.toggle('dark'));
      }
      function showSection(sec) { ['key', 'encrypt', 'decrypt', 'hash', 'qr', 'file', 'about', 'advanced'].forEach(s => { document.getElementById('section-' + s).classList.remove('active'); document.getElementById('tab-' + s)?.classList.remove('active'); }); document.getElementById('section-' + sec).classList.add('active'); document.getElementById('tab-' + sec)?.classList.add('active'); updateHeader(); }
      function onKeyLen() {
        const ok = !!document.getElementById('keySize').value;
        const genBtn = document.getElementById('genBtn');
        genBtn.disabled = !ok;
        genBtn.classList.toggle('disabled', !ok);
        genBtn.classList.toggle('enabled', ok);  // æ·»åŠ å¯ç”¨çŠ¶æ€
      }
      function genRSA() { const bits = +document.getElementById('keySize').value; const kp = forge.pki.rsa.generateKeyPair({ bits, e: 0x10001 }); rsaPub = kp.publicKey; rsaPri = kp.privateKey; document.getElementById('pubKey').value = forge.pki.publicKeyToPem(rsaPub); document.getElementById('priKey').value = forge.pki.privateKeyToPem(rsaPri); }
      function saveRSA() { localStorage.setItem('rsa_pub', document.getElementById('pubKey').value); localStorage.setItem('rsa_pri', document.getElementById('priKey').value); alert('å·²ä¿å­˜å¯†é’¥'); }
      function loadRSA() { const sp = localStorage.getItem('rsa_pub'), si = localStorage.getItem('rsa_pri'), pub = document.getElementById('pubKey'), pri = document.getElementById('priKey'); if (sp || si) { if (sp) pub.value = sp; if (si) pri.value = si; return; } if (!pub.value.trim() && !pri.value.trim()) alert('æ— å¯ç”¨å¯†é’¥'); }
      function togglePane(m) { ['rsa', 'aes'].forEach(p => document.getElementById(p + m + 'Pane').style.display = 'none'); const algo = document.getElementById('algo' + m).value, pane = (algo.startsWith('RSA') ? 'rsa' : 'aes') + m + 'Pane'; document.getElementById(pane).style.display = 'block'; }
      function doEncrypt() { let out, algo = document.getElementById('algoEnc').value; if (algo === 'AES-CBC') { const pwd = document.getElementById('aesPwdEnc').value, salt = forge.random.getBytesSync(16), iv = forge.random.getBytesSync(16), key = forge.pkcs5.pbkdf2(pwd, salt, 1000, 16), cipher = forge.cipher.createCipher('AES-CBC', key); cipher.start({ iv }); cipher.update(forge.util.createBuffer(document.getElementById('textInAESEnc').value, 'utf8')); cipher.finish(); const buf = forge.util.createBuffer(); buf.putBytes(salt); buf.putBytes(iv); buf.putBuffer(cipher.output); out = forge.util.encode64(buf.getBytes()); } else { loadRSA(); out = forge.util.encode64(rsaPub.encrypt(forge.util.encodeUtf8(document.getElementById('textInEnc').value), algo)); } document.getElementById('textOutEnc').value = out; }
      function doDecrypt() { let out, algo = document.getElementById('algoDec').value; if (algo === 'AES-CBC') { try { const pwd = document.getElementById('aesPwdDec').value, data = forge.util.decode64(document.getElementById('textInAESDec').value), buf = forge.util.createBuffer(data), salt = buf.getBytes(16), iv = buf.getBytes(16), ct = buf.getBytes(buf.length()), key = forge.pkcs5.pbkdf2(pwd, salt, 1000, 16), dec = forge.cipher.createDecipher('AES-CBC', key); dec.start({ iv }); dec.update(forge.util.createBuffer(ct)); out = dec.finish() ? forge.util.decodeUtf8(dec.output.getBytes()) : 'è§£å¯†å¤±è´¥ï¼šå¯†ç é”™è¯¯æˆ–æ•°æ®æŸå'; } catch (e) { out = 'è§£å¯†å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯'; } } else { loadRSA(); out = forge.util.decodeUtf8(rsaPri.decrypt(forge.util.decode64(document.getElementById('textInDec').value), algo)); } document.getElementById('textOutDec').value = out; }
      function generateHash() { const algo = document.getElementById('hashAlgo').value.toLowerCase().replace('-', ''), md = forge.md[algo].create(); md.update(document.getElementById('hashInput').value, 'utf8'); document.getElementById('hashOutput').value = md.digest().toHex(); }
      function generateHMAC() {
        const algo = document.getElementById('hmacAlgo').value.toLowerCase().replace('-', '');
        const key = document.getElementById('hmacKey').value;
        const hmac = forge.hmac.create();
        hmac.start({ algorithm: algo, key: key }); // ä¿®å¤è¿™é‡Œçš„ç”¨æ³•
        hmac.update(document.getElementById('hmacInput').value, 'utf8');
        document.getElementById('hmacOutput').value = hmac.digest().toHex();
      }
      function generateQRCode() {
        const text = document.getElementById('qrText').value.trim();
        const container = document.getElementById('qrCode');
        container.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„äºŒç»´ç 
        if (!text) {
          alert('è¯·è¾“å…¥äºŒç»´ç æ–‡æœ¬');
          return;
        }
        QRCode.toCanvas(container, text, { errorCorrectionLevel: 'H' }, (err) => {
          if (err) {
            console.error('äºŒç»´ç ç”Ÿæˆå¤±è´¥:', err); // æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
            alert('äºŒç»´ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥å†…å®¹');
          }
        });
      }
      const fileAlgo = document.getElementById('fileAlgo');
      const fileAesKeyContainer = document.getElementById('fileAesKeyContainer');
      fileAlgo.addEventListener('change', () => {
        fileAesKeyContainer.style.display = fileAlgo.value === 'AES-CBC' ? 'block' : 'none';
      });

      const fileInput = document.getElementById('fileInput');
      const encryptFileBtn = document.getElementById('encryptFileBtn');
      const decryptFileBtn = document.getElementById('decryptFileBtn');

      fileInput.addEventListener('change', () => {
        const hasFile = fileInput.files.length > 0;
        encryptFileBtn.disabled = !hasFile;
        decryptFileBtn.disabled = !hasFile;
        encryptFileBtn.classList.toggle('enabled', hasFile);
        encryptFileBtn.classList.toggle('disabled', !hasFile);
        decryptFileBtn.classList.toggle('enabled', hasFile);
        decryptFileBtn.classList.toggle('disabled', !hasFile);
      });

      encryptFileBtn.addEventListener('click', encryptFile);
      decryptFileBtn.addEventListener('click', decryptFile);

      function encryptFile() {
        const algo = fileAlgo.value;
        const file = fileInput.files[0];
        if (!file) { alert("è¯·é€‰æ‹©æ–‡ä»¶"); return; }
        const reader = new FileReader();
        reader.onload = function (e) {
          const fileData = e.target.result;
          let result = { filename: file.name, algo: algo };
          if (algo === 'RSA-OAEP') {
            loadRSA();
            // ç”ŸæˆéšæœºAESå¯†é’¥ä¸IVï¼Œå¹¶ç”¨RSAåŠ å¯†AESå¯†é’¥
            const key = forge.random.getBytesSync(16);
            const iv = forge.random.getBytesSync(16);
            const cipher = forge.cipher.createCipher('AES-CBC', key);
            cipher.start({ iv: iv });
            cipher.update(forge.util.createBuffer(fileData));
            cipher.finish();
            const encrypted = cipher.output.getBytes();
            const encKey = rsaPub.encrypt(key, 'RSA-OAEP');
            result.encKey = forge.util.encode64(encKey);
            result.iv = forge.util.encode64(iv);
            result.cipherText = forge.util.encode64(encrypted);
          } else if (algo === 'AES-CBC') {
            // ä½¿ç”¨ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥çš„AESå¯†é’¥ï¼ˆå–å‰16å­—ç¬¦ï¼‰
            const rawKey = document.getElementById('fileAesKey').value;
            if (rawKey.length < 16) { alert("è¯·è¾“å…¥è‡³å°‘16å­—ç¬¦çš„AESå¯†é’¥"); return; }
            const key = rawKey.substr(0, 16);
            const iv = forge.random.getBytesSync(16);
            const cipher = forge.cipher.createCipher('AES-CBC', key);
            cipher.start({ iv: iv });
            cipher.update(forge.util.createBuffer(fileData));
            cipher.finish();
            result.iv = forge.util.encode64(iv);
            result.cipherText = forge.util.encode64(cipher.output.getBytes());
          }
          const jsonStr = JSON.stringify(result);
          const blob = new Blob([jsonStr], { type: "application/json" });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = file.name + ".enc.json";
          link.click();
        };
        // å¯¹äºåŠ å¯†æ–‡ä»¶ï¼Œè‹¥é€‰ç”¨AESåˆ™è¯»äºŒè¿›åˆ¶å³å¯
        reader.readAsBinaryString(file);
      }

      function decryptFile() {
        const algo = fileAlgo.value;
        const file = fileInput.files[0];
        if (!file) { alert("è¯·é€‰æ‹©æ–‡ä»¶"); return; }
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const obj = JSON.parse(e.target.result);
            // æ ¹æ®åŠ å¯†ç®—æ³•åˆ†æ”¯å¤„ç†
            if (algo === 'RSA-OAEP') {
              loadRSA();
              const encKey = forge.util.decode64(obj.encKey);
              const iv = forge.util.decode64(obj.iv);
              const cipherText = forge.util.decode64(obj.cipherText);
              const key = rsaPri.decrypt(encKey, 'RSA-OAEP');
              const decipher = forge.cipher.createDecipher('AES-CBC', key);
              decipher.start({ iv: iv });
              decipher.update(forge.util.createBuffer(cipherText));
              if (!decipher.finish()) {
                alert("è§£å¯†å¤±è´¥ï¼šå¯†é’¥é”™è¯¯æˆ–æ•°æ®æŸå");
                return;
              }
              var decryptedData = decipher.output.getBytes();
            } else if (algo === 'AES-CBC') {
              // ä½¿ç”¨ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥çš„AESå¯†é’¥
              const rawKey = document.getElementById('fileAesKey').value;
              if (rawKey.length < 16) { alert("è¯·è¾“å…¥è‡³å°‘16å­—ç¬¦çš„AESå¯†é’¥"); return; }
              const key = rawKey.substr(0, 16);
              const iv = forge.util.decode64(obj.iv);
              const cipherText = forge.util.decode64(obj.cipherText);
              const decipher = forge.cipher.createDecipher('AES-CBC', key);
              decipher.start({ iv: iv });
              decipher.update(forge.util.createBuffer(cipherText));
              if (!decipher.finish()) {
                alert("è§£å¯†å¤±è´¥ï¼šå¯†é’¥é”™è¯¯æˆ–æ•°æ®æŸå");
                return;
              }
              var decryptedData = decipher.output.getBytes();
            }
            const blob = new Blob([decryptedData], { type: "application/octet-stream" });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = obj.filename || "decrypted";
            link.click();
          } catch (e) {
            alert("è§£å¯†å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯");
          }
        };
        reader.readAsText(file);
      }

      // æ–°å¢ï¼šä½¿ç”¨æ¬¡æ•°åŠŸèƒ½åŠ Cookie æ“ä½œ
      function getCookie(name) {
        const parts = document.cookie.split("; ");
        for (let part of parts) {
          const [key, val] = part.split("=");
          if (key === name) return decodeURIComponent(val);
        }
        return null;
      }
      function setCookie(name, value, days) {
        const d = new Date();
        d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
        document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/";
      }
      function checkUsage() {
        if (getCookie("advancedUnlocked") === "true") return true;
        let count = parseInt(getCookie("usageRemaining") || "10");
        if (count <= 0) {
          alert("ä½¿ç”¨æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·è§£é”é«˜çº§åŠŸèƒ½ï¼");
          return false;
        }
        count--;
        setCookie("usageRemaining", count, 7);
        updateUsageUI(count);
        return true;
      }
      // åˆå§‹åŒ–ä½¿ç”¨æ¬¡æ•°æˆ–æ˜¾ç¤ºæ— é™åˆ¶
      if (getCookie("advancedUnlocked") === "true") {
        updateUsageUI("æ— é™åˆ¶");
      } else {
        if (!getCookie("usageRemaining")) {
          setCookie("usageRemaining", 10, 7);
          updateUsageUI(10);
        } else {
          updateUsageUI(getCookie("usageRemaining"));
        }
      }

      // å¼¹çª—åŠŸèƒ½
      function showAdvancedModal() {
        document.getElementById("advancedModal").style.display = "block";
        document.getElementById("modalOverlay").style.display = "block";
      }
      function closeAdvancedModal() {
        document.getElementById("advancedModal").style.display = "none";
        document.getElementById("modalOverlay").style.display = "none";
      }
      document.getElementById("closeModal").onclick = closeAdvancedModal;
      function sha512(message) {
        const encoder = new TextEncoder();
        const data = encoder.encode(message);
        return crypto.subtle.digest("SHA-512", data)
          .then(buffer => {
            const hashArray = Array.from(new Uint8Array(buffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
          });
      }

      // ç¤ºä¾‹ï¼šè®¡ç®— "hello world" çš„ SHA-512 å“ˆå¸Œ
      async function attemptUnlock() {
        // å¦‚æœå·²ç»è§£é”ï¼Œæç¤ºç”¨æˆ·å·²è§£é”
        if (
          document.getElementById("advancedModal").style.display === "none" &&
          document.getElementById("modalOverlay").style.display === "none"
        ) {
          alert("é«˜çº§åŠŸèƒ½å·²è§£é”ï¼");
          closeAdvancedModal();
          return;
        }
        const acc = document.getElementById("accountInput").value;
        const pwd = document.getElementById("passwordInput").value;
        const hashedPwd = await sha512(pwd); // è·å– SHA-512 å“ˆå¸Œå€¼
        // è¯·å°†ä¸‹é¢ "é¢„è®¾å“ˆå¸Œå€¼" æ›¿æ¢ä¸ºä½ é¢„å…ˆè®¡ç®—å¥½çš„å“ˆå¸Œç»“æœ
        const presetHash = "2327c80dbd7faa5e223501ed4537bce095e368953c7fc5a55d1fc439e049ec64dae7e993110019812331a0e58a2edb8078e65f607d5eaf0422a0b015a3f20b2f";
        if (acc === "admin" && hashedPwd === presetHash) {
          setCookie("advancedUnlocked", "true", 7);
          alert("é«˜çº§åŠŸèƒ½è§£é”æˆåŠŸï¼");
          closeAdvancedModal();
          updateUsageUI("æ— é™åˆ¶");
          document.getElementById("unlockBtn").textContent = "å·²è§£é”";
        } else {
          alert("è´¦æˆ·æˆ–å¯†ç é”™è¯¯ï¼");
        }
      }

      // ä¿®æ”¹éƒ¨åˆ†åŠŸèƒ½æ“ä½œå‰å…ˆæ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
      const _oldGenRSA = genRSA;
      genRSA = function () {
        if (!checkUsage()) return;
        _oldGenRSA();
      };
      const _oldDoEncrypt = doEncrypt;
      doEncrypt = function () {
        if (!checkUsage()) return;
        showProgress(_oldDoEncrypt);
      };
      const _oldDoDecrypt = doDecrypt;
      doDecrypt = function () {
        if (!checkUsage()) return;
        showProgress(_oldDoDecrypt);
      };
      const _oldGenerateHash = generateHash;
      generateHash = function () {
        if (!checkUsage()) return;
        showProgress(_oldGenerateHash);
      };
      const _oldGenerateHMAC = generateHMAC;
      generateHMAC = function () {
        if (!checkUsage()) return;
        showProgress(_oldGenerateHMAC);
      };
      const _oldGenerateQRCode = generateQRCode;
      generateQRCode = function () {
        if (!checkUsage()) return;
        showProgress(_oldGenerateQRCode);
      };
      const _oldEncryptFile = encryptFile;
      encryptFile = function () {
        if (!checkUsage()) return;
        showProgress(_oldEncryptFile);
      };
      const _oldDecryptFile = decryptFile;
      decryptFile = function () {
        if (!checkUsage()) return;
        showProgress(_oldDecryptFile);
      };

      // ä¿®æ”¹è¿›åº¦æ¡æ§åˆ¶å‡½æ•°ï¼šè¿›åº¦æ¡å¸¸é©»æ˜¾ç¤ºå¹¶åŠ¨ç”»æµç•…
      function showProgress(callback) {
        const progressContainer = document.getElementById("progressContainer");
        const progressBar = document.getElementById("progressBar");
        progressContainer.style.display = "block";
        progressBar.style.width = "0%";
        let percent = 0;
        const intervalId = setInterval(() => {
          percent += 5;
          progressBar.style.width = percent + "%";
          if (percent >= 100) {
            clearInterval(intervalId);
            callback();
            // ä¿æŒè¿›åº¦æ¡æ˜¾ç¤ºåœ¨100%
          }
        }, 50);
      }

      // æš´éœ²å‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾›å†…è”äº‹ä»¶è°ƒç”¨
      Object.assign(window, {
        setLang, setTheme, toggleDark, showSection, onKeyLen,
        genRSA, saveRSA, loadRSA, togglePane,
        doEncrypt, doDecrypt, generateHash, generateHMAC,
        generateQRCode, encryptFile, decryptFile,
        showAdvancedModal, closeAdvancedModal, attemptUnlock,
        getCookie, setCookie, checkUsage, updateUsageUI
      });
    });
  </script>
</body>

</html>
