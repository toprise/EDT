<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>通用加密解密工具</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    /* 主题变量 */
    :root {
      --bg-blue: #eaf6ff; --header-blue: #cfe8fc; --btn-blue: #a5d8ff;
      --bg-pink: #fff0f5; --header-pink: #ffd3e0; --btn-pink: #ffb0c9;
      --bg-dark: #2c2c2e; --header-dark: #3a3a3c; --btn-dark: #5e5e60;
      --txt-light: #333; --txt-dark: #f2f2f7;
    }
    body { font-family:'Noto Sans SC',sans-serif; margin:30px; display:flex; flex-direction:column; align-items:center; background:var(--bg-blue); color:var(--txt-light); transition:background .3s, color .3s; }
    body.dark { background:var(--bg-dark); color:var(--txt-dark); }
    .card, .theme-card { width:1000px; border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.15); transition:background .3s; }
    .card { background:#fff; overflow:hidden; } .card.dark { background:var(--bg-dark); }
    .theme-card { display:flex; justify-content:flex-end; gap:10px; margin-bottom:20px; padding:15px; background:var(--header-blue); }
    .theme-card.pink { background:var(--header-pink); }
    .theme-card.dark { background:var(--header-dark); }

    /* 按钮 */
    .theme-btn { border:none; border-radius:12px; padding:8px 16px; cursor:pointer; background:#eee; transition:background .3s; }
    .theme-btn.blue.selected { background:var(--btn-blue); color:#fff; }
    .theme-btn.pink.selected { background:var(--btn-pink); color:#fff; }
    .theme-btn.dark.selected { background:var(--btn-dark); color:#fff; }

    /* 自定义下拉菜单 */
    .custom-select {
      position: relative;
      display: inline-block;
      width: 100%;
      margin-top:5px;
    }
    .custom-select select {
      display: none;
    }
    .select-selected {
      background-color: #eee;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
    }
    .select-items {
      position: absolute;
      background-color: #fff;
      top: 100%; left: 0;
      right: 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 99;
      display: none;
    }
    .select-items div {
      padding: 10px;
      cursor: pointer;
    }
    .select-items div:hover { background-color: #f1f1f1; }

    /* Tabs */
    .tabs { display:flex; background:var(--header-blue); }
    .tabs.pink { background:var(--header-pink); }
    .tabs.dark { background:var(--header-dark); }
    .tabs div { flex:1; text-align:center; padding:12px; cursor:pointer; white-space:nowrap; }
    .tabs div.active { border-bottom:3px solid #42a5f5; background:#fff; }

    /* 内容区域 */
    .card-header { text-align:center; padding:12px; font-size:20px; font-weight:500; background:var(--header-blue); }
    .card-header.pink { background:var(--header-pink); }
    .card-header.dark { background:var(--header-dark); }
    .card-body { padding:20px; }
    .section { display:none; } .section.active { display:block; }
    label { display:block; margin-top:10px; font-weight:500; }
    textarea, input[type=password], input[type=text] { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; }
    button.action { margin-top:10px; padding:10px; border:none; border-radius:8px; cursor:pointer; }
    .storage button { flex:1; }
    #qrCode { margin-top:20px; }
  </style>
</head>
<body>
  <div class="theme-card" id="themeCard">
    <button class="theme-btn blue selected" data-theme="blue">🔵 浅蓝</button>
    <button class="theme-btn pink" data-theme="pink">🌸 淡粉</button>
    <button class="theme-btn dark" data-theme="dark">🌓 深色</button>
  </div>
  <div class="card" id="mainCard">
    <div class="tabs" id="tabs">
      <div data-tab="key" class="active">密钥管理</div>
      <div data-tab="encrypt">加密</div>
      <div data-tab="decrypt">解密</div>
      <div data-tab="hash">哈希& HMAC</div>
      <div data-tab="qr">二维码</div>
      <div data-tab="file">文件处理</div>
      <div data-tab="about">关于</div>
    </div>
    <div class="card-header" id="header">密钥管理</div>
    <div class="card-body">
      <div id="section-key" class="section active">
        <label>RSA 密钥长度：</label>
        <div class="custom-select" id="keySelect">
          <div class="select-selected">-- 请选择 --</div>
          <div class="select-items">
            <div data-value="512">512</div>
            <div data-value="1024">1024</div>
            <div data-value="2048">2048</div>
          </div>
        </div>
        <button class="action" id="genBtn" disabled>生成密钥</button>
        <div class="storage" style="display:flex; gap:10px;">
          <button class="action" id="saveBtn">保存密钥</button>
          <button class="action" id="loadBtn">加载密钥</button>
        </div>
        <label>公钥：</label><textarea id="pubKey"></textarea>
        <label>私钥：</label><textarea id="priKey"></textarea>
      </div>
      <div id="section-encrypt" class="section">
        <label>算法：</label>
        <div class="custom-select" id="algoEncSelect">
          <div class="select-selected">RSA-OAEP</div>
          <div class="select-items"><div>RSA-OAEP</div><div>RSAES-PKCS1-V1_5</div><div>AES-CBC</div></div>
        </div>
        <div id="rsaEncPane">
          <label>明文：</label><textarea id="textInEnc"></textarea>
        </div>
        <div id="aesEncPane" style="display:none">
          <label>密码：</label><input type="password" id="aesPwdEnc" />
          <label>明文：</label><textarea id="textInAESEnc"></textarea>
        </div>
        <button class="action" id="encBtn">加密</button>
        <label>结果：</label><textarea id="textOutEnc" readonly></textarea>
      </div>
      <!-- 其余板块省略... -->
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // 主题切换
    document.querySelectorAll('.theme-btn').forEach(btn=>btn.addEventListener('click',()=>{
      const t=btn.dataset.theme;
      document.body.className = t==='dark'? 'dark':'';
      document.documentElement.style.setProperty('--bg-light', t==='blue'? 'var(--bg-blue)': t==='pink'? 'var(--bg-pink)': 'var(--bg-dark)');
      document.querySelector('.theme-card').className = 'theme-card ' + (t==='pink'? 'pink': t==='dark'? 'dark':'');
      document.querySelector('.tabs').className = 'tabs ' + (t==='pink'? 'pink': t==='dark'? 'dark':'');
      document.querySelector('.card-header').className = 'card-header ' + (t==='pink'? 'pink': t==='dark'? 'dark':'');
    }));
    // 自定义下拉功能
    function setupSelect(id, callback) {
      const sel = document.getElementById(id);
      const head = sel.querySelector('.select-selected');
      const items = sel.querySelector('.select-items');
      head.addEventListener('click', ()=>{ items.style.display = items.style.display==='block'? 'none':'block'; });
      items.querySelectorAll('div').forEach(div=>{
        div.addEventListener('click', ()=>{
          head.textContent = div.textContent;
          items.style.display = 'none';
          callback(div.dataset.value||div.textContent);
        });
      });
      document.addEventListener('click', e=>{ if(!sel.contains(e.target)) items.style.display='none'; });
    }
    // 初始化 RSA 长度下拉
    setupSelect('keySelect', val=>{
      document.getElementById('genBtn').disabled = !val;
      window.selectedKeyLen = val;
    });
    // 初始化加密算法下拉
    setupSelect('algoEncSelect', val=>{
      document.getElementById('rsaEncPane').style.display = val.startsWith('AES')? 'none':'block';
      document.getElementById('aesEncPane').style.display = val==='AES-CBC'? 'block':'none';
      window.selectedAlgoEnc = val;
    });
    // 生成 RSA
    document.getElementById('genBtn').addEventListener('click', ()=>{
      const bits = parseInt(window.selectedKeyLen);
      const kp = forge.pki.rsa.generateKeyPair({ bits, e:0x10001 });
      document.getElementById('pubKey').value = forge.pki.publicKeyToPem(kp.publicKey);
      document.getElementById('priKey').value = forge.pki.privateKeyToPem(kp.privateKey);
    });
    // 生成二维码示例
    document.getElementById('encBtn').addEventListener('click', ()=>{
      const text = document.getElementById('textInEnc').value;
      QRCode.toCanvas(document.getElementById('qrCode'), text, {}, err=>{ if(err) alert('二维码生成失败'); });
    });
  </script>
</body>
</html>
