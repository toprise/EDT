<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RSAåŠ å¯†è§£å¯†å·¥å…·</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      /* åŠ¨æ€æµ…è‰²ä¸»é¢˜å˜é‡ï¼ˆå¯åˆ‡æ¢ï¼‰ */
      --bg-light: #eaf6ff;
      --header-light: #cfe8fc;
      --btn-light: #a5d8ff;

      /* å›ºå®šç²‰è‰²ä¸»é¢˜å˜é‡ */
      --bg-pink: #fff0f5;
      --header-pink: #ffd3e0;
      --btn-pink: #ffb0c9;

      /* æ·±è‰²æ¨¡å¼å˜é‡ */
      --bg-dark: #2c2c2e;
      --header-dark: #3a3a3c;
      --btn-dark: #5e5e60;

      /* é€šç”¨ */
      --text-light: #333;
      --text-dark: #f2f2f7;
    }

    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
      margin: 30px;
      display: flex; flex-direction: column; align-items: center;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    /* ä¸»é¢˜æ§åˆ¶å¡ç‰‡ */
    .theme-card {
      width: 800px; background: #fff;
      border-radius: 20px; box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      padding: 15px; margin-bottom: 20px;
      display: flex; justify-content: flex-end; gap: 10px;
    }
    .theme-card.dark { background: var(--header-dark); }

    .theme-btn {
      border: none; border-radius: 12px;
      padding: 10px 20px; font-size: 14px; cursor: pointer;
      transition: background 0.3s, color 0.3s;
      background: #eee; color: #333;
    }
    .theme-card.dark .theme-btn { background: var(--btn-dark); color: var(--text-dark); }
    .theme-btn.blue.selected { background: var(--btn-light); color: #fff; }
    .theme-btn.pink.selected { background: var(--btn-pink); color: #fff; }

    /* ä¸»å¡ç‰‡ */
    .main-card {
      width: 800px; background: #fff;
      border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      overflow: hidden; transition: background 0.3s, color 0.3s;
    }
    .main-card.dark { background: var(--bg-dark); }

    .tabs {
      display: flex; background: var(--bg-light);
    }
    .tabs.dark { background: var(--header-dark); }
    .tabs div {
      flex: 1; text-align: center; padding: 15px;
      cursor: pointer; font-weight: 500; transition: background 0.3s;
    }
    .tabs div.active { background: var(--header-light); }
    .tabs.dark div.active { background: var(--header-dark); }

    .card-header {
      text-align: center; background: var(--header-light);
      padding: 10px; font-size: 20px; font-weight: 500;
      transition: background 0.3s, color 0.3s;
    }
    .card-header.dark { background: var(--header-dark); }

    .card-body {
      padding: 20px; background: #fff;
      transition: background 0.3s;
    }
    .card-body.dark { background: var(--bg-dark); }

    .section { display: none; }
    .section.active { display: block; }

    .section-inner { max-width: 350px; margin: 0 auto; }

    label { font-weight: 500; }

    textarea, select, input, button {
      width: 100%; padding: 12px; margin: 10px 0;
      border-radius: 12px; border: 1px solid #ccc;
      font-size: 16px; font-family: inherit;
      transition: background 0.3s, color 0.3s;
    }
    body.dark textarea,
    body.dark select,
    body.dark input {
      background: #3a3a3c; color: var(--text-dark); border-color: #444;
    }

    button {
      background-color: var(--btn-light);
      color: white; border: none; cursor: pointer;
    }
    body.dark button { background-color: var(--btn-dark); }
    button:hover { opacity: 0.9; }
    .disabled { background: #eee; cursor: not-allowed; }

    .storage-buttons { display: flex; gap: 10px; margin-top: 10px; }
    .storage-buttons button { flex: 1; }
  </style>
</head>
<body>

  <!-- ä¸»é¢˜/å¤œé—´å¡ç‰‡ -->
  <div class="theme-card" id="themeCard">
    <button class="theme-btn blue selected" onclick="setTheme('blue')">ğŸ”µ æµ…è“</button>
    <button class="theme-btn pink" onclick="setTheme('pink')">ğŸŒ¸ æ·¡ç²‰</button>
    <button class="theme-btn" onclick="toggleDark()">ğŸŒ“ å¤œé—´</button>
  </div>

  <!-- ä¸»å¡ç‰‡ -->
  <div class="main-card" id="mainCard">
    <div class="tabs" id="tabs">
      <div id="tab-key" class="active" onclick="showSection('key')">å¯†é’¥ç®¡ç†</div>
      <div id="tab-encrypt" onclick="showSection('encrypt')">åŠ å¯†</div>
      <div id="tab-decrypt" onclick="showSection('decrypt')">è§£å¯†</div>
    </div>
    <div class="card-header" id="title">å¯†é’¥ç®¡ç†</div>
    <div class="card-body" id="cardBody">
      <div id="section-key" class="section active">
        <div class="section-inner">
          <label>é€‰æ‹©å¯†é’¥é•¿åº¦ï¼š</label>
          <select id="keySize" onchange="onKeySizeChange()">
            <option value="">-- è¯·é€‰æ‹© --</option>
            <option value="512">512</option>
            <option value="1024">1024</option>
            <option value="2048">2048</option>
          </select>
          <button id="genBtn" class="disabled" onclick="generateKeys()" disabled>ç”Ÿæˆå¯†é’¥å¯¹</button>
          <div class="storage-buttons">
            <button onclick="saveKeys()">ğŸ’¾ ä¿å­˜å¯†é’¥</button>
            <button onclick="loadKeys()">ğŸ“‚ åŠ è½½å¯†é’¥</button>
          </div>
          <label>æˆ– è‡ªå®šä¹‰å¯†é’¥ï¼ˆå…ˆé€‰æ‹©é•¿åº¦ï¼‰ï¼š</label>
          <textarea id="publicKey" rows="3" placeholder="ç²˜è´´å…¬é’¥ï¼ˆPEMï¼‰"></textarea>
          <textarea id="privateKey" rows="3" placeholder="ç²˜è´´ç§é’¥ï¼ˆPEMï¼‰"></textarea>
        </div>
      </div>
      <div id="section-encrypt" class="section">
        <div class="section-inner">
          <label>å¾…åŠ å¯†å†…å®¹ï¼š</label>
          <textarea id="plaintext" rows="3"></textarea>
          <button onclick="encrypt()">ğŸ”’ åŠ å¯†</button>
          <label>åŠ å¯†ç»“æœï¼ˆBase64ï¼‰ï¼š</label>
          <textarea id="ciphertext" rows="3" readonly></textarea>
        </div>
      </div>
      <div id="section-decrypt" class="section">
        <div class="section-inner">
          <label>å¾…è§£å¯†å†…å®¹ï¼ˆBase64ï¼‰ï¼š</label>
          <textarea id="cipherInput" rows="3"></textarea>
          <button onclick="decrypt()">ğŸ”“ è§£å¯†</button>
          <label>è§£å¯†ç»“æœï¼š</label>
          <textarea id="decryptedText" rows="3" readonly></textarea>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <script>
    let publicKeyObj, privateKeyObj;

    function showSection(name) {
      ['key','encrypt','decrypt'].forEach(sec => {
        document.getElementById('section-'+sec).classList.remove('active');
        document.getElementById('tab-'+sec).classList.remove('active');
      });
      document.getElementById('section-'+name).classList.add('active');
      document.getElementById('tab-'+name).classList.add('active');
      document.getElementById('title').textContent = {key:'å¯†é’¥ç®¡ç†', encrypt:'åŠ å¯†', decrypt:'è§£å¯†'}[name];
    }

    function onKeySizeChange() {
      const sel=document.getElementById('keySize').value;
      const btn=document.getElementById('genBtn');
      sel?btn.removeAttribute('disabled'):(btn.setAttribute('disabled',true));
      sel?btn.classList.remove('disabled'):btn.classList.add('disabled');
    }

    function generateKeys() {
      const sz=+document.getElementById('keySize').value;
      const kp=forge.pki.rsa.generateKeyPair({bits:sz,e:0x10001});
      publicKeyObj=kp.publicKey; privateKeyObj=kp.privateKey;
      document.getElementById('publicKey').value=forge.pki.publicKeyToPem(publicKeyObj);
      document.getElementById('privateKey').value=forge.pki.privateKeyToPem(privateKeyObj);
    }

    function loadKeysFromInput() {
      try {
        const pub=document.getElementById('publicKey').value.trim();
        const pri=document.getElementById('privateKey').value.trim();
        if(pub) publicKeyObj=forge.pki.publicKeyFromPem(pub);
        if(pri) privateKeyObj=forge.pki.privateKeyFromPem(pri);
      } catch {
        alert('å¯†é’¥æ ¼å¼ä¸æ­£ç¡®');
      }
    }

    function encrypt() {
      loadKeysFromInput();
      if(!publicKeyObj){alert('è¯·å…ˆç”Ÿæˆæˆ–è¾“å…¥å…¬é’¥');return;}
      const enc=publicKeyObj.encrypt(forge.util.encodeUtf8(document.getElementById('plaintext').value),'RSA-OAEP');
      document.getElementById('ciphertext').value=forge.util.encode64(enc);
    }

    function decrypt() {
      loadKeysFromInput();
      if(!privateKeyObj){alert('è¯·å…ˆç”Ÿæˆæˆ–è¾“å…¥ç§é’¥');return;}
      try {
        const dec=privateKeyObj.decrypt(forge.util.decode64(document.getElementById('cipherInput').value),'RSA-OAEP');
        document.getElementById('decryptedText').value=forge.util.decodeUtf8(dec);
      } catch {
        alert('è§£å¯†å¤±è´¥ï¼Œè¯·ç¡®è®¤è¾“å…¥æ­£ç¡®');
      }
    }

    function toggleDark() {
      document.body.classList.toggle('dark');
      document.getElementById('themeCard').classList.toggle('dark');
      document.getElementById('mainCard').classList.toggle('dark');
      document.getElementById('tabs').classList.toggle('dark');
      document.querySelector('.card-header').classList.toggle('dark');
      document.querySelector('.card-body').classList.toggle('dark');
    }

    function setTheme(color) {
      // å…ˆæ¸…é™¤é€‰ä¸­æ€
      document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('selected'));
      document.querySelector(`.theme-btn.${color}`)?.classList.add('selected');
      // æ›´æ–°åŠ¨æ€ä¸»é¢˜å˜é‡
      if(color==='blue') {
        document.documentElement.style.setProperty('--bg-light','#eaf6ff');
        document.documentElement.style.setProperty('--header-light','#cfe8fc');
        document.documentElement.style.setProperty('--btn-light','#a5d8ff');
      } else {
        document.documentElement.style.setProperty('--bg-light','var(--bg-pink)');
        document.documentElement.style.setProperty('--header-light','var(--header-pink)');
        document.documentElement.style.setProperty('--btn-light','var(--btn-pink)');
      }
      // åŒæ­¥ä¸»å¡ç‰‡èƒŒæ™¯
      document.querySelector('.tabs').style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-light');
      document.querySelector('.card-header').style.background = getComputedStyle(document.documentElement).getPropertyValue('--header-light');
      document.querySelectorAll('button:not(.theme-btn)').forEach(btn=> {
        btn.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--btn-light');
      });
    }

    function saveKeys() {
      localStorage.setItem('rsa_publicKey',document.getElementById('publicKey').value);
      localStorage.setItem('rsa_privateKey',document.getElementById('privateKey').value);
      alert('å·²ä¿å­˜åˆ°æœ¬åœ°');
    }
    function loadKeys() {
      const pub=localStorage.getItem('rsa_publicKey');
      const pri=localStorage.getItem('rsa_privateKey');
      if(pub||pri) {
        document.getElementById('publicKey').value=pub||'';
        document.getElementById('privateKey').value=pri||'';
        alert('å·²ä»æœ¬åœ°åŠ è½½');
      } else {
        alert('æœ¬åœ°æ— å¯†é’¥è®°å½•');
      }
    }
  </script>
</body>
</html>
